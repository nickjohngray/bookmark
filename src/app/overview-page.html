<!-- OVERVIEW PAGE -->
<section class="container">
  <h1>Bookmark Manager</h1>

  <!-- Developer tools: seed, clear, sample -->
  <div class="dev-tools">
    <button type="button" (click)="loadTestData()">Load Test Data</button>
    <button type="button" (click)="clearAll()">Clear All</button>
    <button type="button" (click)="addSample()">Add Sample</button>
  </div>

  <!-- Add URL form (custom validation happens in TS) -->
  <form class="add-form" (submit)="add(urlInput); $event.preventDefault()">
    <label class="sr-only" for="url">Add a URL</label>
    <input
      #urlInput
      id="url"
      class="url-input"
      type="text"
      name="url"
      placeholder="Add a URL"
      autocomplete="off"
      aria-label="Add a URL"
    />
    <button type="submit">Add</button>
  </form>

  <!-- Small live region for hover preview (null-safe) -->
  <div *ngIf="hoveredBookmark as hb" class="link-preview-global" aria-live="polite">
    <h2 class="sr-only">Preview</h2>
    <img [src]="previewUrl(hb.url)" alt="Preview" />
  </div>

  <!-- Bookmarks list (20 per page; see pagination below) -->
  <div class="bookmark-scroll-container">
    <ul class="bookmark-list">
      <!--
        Row behavior:
        - List item is focusable for keyboard nav
        - Enter starts edit; Up/Down move selection
        - Hover sets hoveredBookmark for preview & actions
        - Click anywhere in the row enters edit mode
      -->
      <li
        *ngFor="let bookmark of paginatedBookmarks; let i = index"
        class="bookmark-item"
        tabindex="0"
        [attr.id]="'bookmark-item-' + i"
        (focus)="handleItemFocus(i)"
        (blur)="focusedId = null"
        (click)="startEditingAndFocusToInput(bookmark)"
        (mouseenter)="hoveredId = bookmark.id; hoveredBookmark = { id: bookmark.id, url: bookmark.url }"
        (mouseleave)="hoveredId = null; hoveredBookmark = null"
        (keydown.ArrowDown)="editNextItem(i)"
        (keydown.ArrowUp)="editPreviousItem(i)"
        (keydown.enter)="startEditing(bookmark)"
      >
        <div class="bookmark-content">
          <!-- Read mode -->
          <ng-container *ngIf="editingId !== bookmark.id; else editTpl">
            <span class="bookmark-text">{{ bookmark.url }}</span>

            <!-- Actions: visible on hover/focus; also visible on touch via CSS -->
            <span class="bookmark-buttons" [class.visible]="editingId === null">
              <!-- Open -->
              <button
                class="edit-btn"
                type="button"
                title="Open"
                (click)="openWindow(bookmark)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <path d="M18 13v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                  <polyline points="15 3 21 3 21 9" />
                  <line x1="10" y1="14" x2="21" y2="3" />
                </svg>
              </button>

              <!-- Delete -->
              <button
                class="delete-btn"
                type="button"
                title="Delete"
                (click)="delete(bookmark.id)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="16"
                  height="16"
                  fill="#ff4d4d"
                  aria-hidden="true"
                >
                  <path
                    d="M3 6h18v2H3V6zm2 3h14v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V9zm5 3v8h2v-8H10zm4 0v8h2v-8h-2zM9 4V2h6v2h5v2H4V4h5z"
                  />
                </svg>
              </button>
            </span>
          </ng-container>

          <!-- Edit mode -->
          <ng-template #editTpl>
            <div class="edit-mode">
              <input
                type="text"
                [(ngModel)]="editingValue"
                name="editUrl-{{ bookmark.id }}"
                placeholder="Enter new URL"
                (keydown.enter)="save($event)"
                (keyup.escape)="cancelEdit()"
                autofocus
                aria-label="Edit URL"
              />
              <div class="actions">
                <button
                  type="button"
                  class="btn btn--primary"
                  title="Save"
                  (click)="save($event)"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                  >
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                </button>

                <button
                  type="button"
                  class="btn"
                  title="Cancel"
                  (click)="cancelEdit()"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                  >
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                  </svg>
                </button>
              </div>
            </div>
          </ng-template>
        </div>
      </li>
    </ul>
  </div>

  <!-- Pagination: < 1 2 3 > -->
  <nav class="pagination" aria-label="Pagination">
    <button type="button" (click)="prevPage()" [disabled]="currentPage === 1">
      &lt;
    </button>

    <button
      type="button"
      *ngFor="let _ of [].constructor(totalPages); let idx = index"
      (click)="goToPage(idx + 1)"
      [class.active]="currentPage === idx + 1"
      [attr.aria-current]="currentPage === idx + 1 ? 'page' : null"
    >
      {{ idx + 1 }}
    </button>

    <button
      type="button"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages"
    >
      &gt;
    </button>
  </nav>
</section>
